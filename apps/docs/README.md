# Morse Converter Documentation
Here you will find the project documentation, usage, commands, and everything needed to clone the project and run it locally.

## Table of Contents
- [Morse Converter Documentation](#morse-converter-documentation)
	- [Table of Contents](#table-of-contents)
	- [Getting Started](#getting-started)
		- [Prerequisites](#prerequisites)
		- [Installation](#installation)
	- [Commands](#commands)
	- [Add Packages](#add-packages)
	- [Automatic Releases](#automatic-releases)
	- [License](#license)

## Getting Started
These are the commands used to build the monorepo.

```bash
pnpm init
pnpm dlx create-next-app@latest apps/next --ts --no-tailwind --eslint false --app --src-dir
pnpm create expo-app apps/mobile --template blank-typescript
```

### Prerequisites
- Have an [EAS](https://expo.dev/eas) account in order to create a build of the mobile app.

### Installation
- Clone repository
```bash
git clone https://github.com/mardecera/morse-converter.git
```
- Install packages
```bash
pnpm install
```

## Commands

| Command                | Description                                                    |
| ---------------------- | -------------------------------------------------------------- |
| pnpm build             | builds the web page made with Next.js                          |
| pnpm dev               | starts the web and mobile app (in Expo Go mode)                |
| pnpm check-types       | checks the types                                               |
| pnpm lint              | runs linting across the entire monorepo                        |
| pnpm format            | formats all files in the monorepo                              |
| pnpm build:dev:android | builds the mobile app for Android with EAS in development mode |
| pnpm start:dev:android | starts the build generated by `build:dev:android`              |

## Add Packages
To add new packages, you must use the flag filter to determine which app to add them to.

```bash
pnpm add <package-name> --filter=<app-name>
```

## Automatic Releases
In the future, a GitHub action will be implemented to create automatic APK releases when versions are upgraded (release.yml).

````yml
name: Release APK

on:
  push:
    branches:
      - master

jobs:
  build-and-release:
    name: Build and Release Expo APK
    runs-on: ubuntu-latest
    env:
      EXPO_TOKEN: ${{ secrets.EAS_API_KEY }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v5

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Setup PNPM
        uses: pnpm/action-setup@v4

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Install Expo & EAS CLI
        uses: expo/expo-github-action@v8
        with:
          eas-version: latest
          packager: pnpm
          token: ${{ env.EXPO_TOKEN }}

      # ðŸš€ Start remote EAS build (no output json)
      - name: Start APK Build
        id: eas-build
        run: |
          cd apps/mobile
          RAW=$(eas build --platform android --profile production --non-interactive --json)
          echo "$RAW"
          BUILD_ID=$(echo "$RAW" | jq -r '.[0].id')
          echo "BUILD_ID=$BUILD_ID" >> $GITHUB_OUTPUT

      # â³ Wait for EAS Build to finish (robust)
      - name: Wait for EAS Build (API polling)
        id: wait-build
        run: |
          BUILD_ID=${{ steps.eas-build.outputs.BUILD_ID }}

          echo "Polling EAS API for build: $BUILD_ID"

          STATUS="in-queue"

          while [[ "$STATUS" != "finished" ]]; do
            sleep 10
            RAW=$(curl -s \
              -H "Authorization: Bearer $EXPO_TOKEN" \
              "https://api.expo.dev/v2/builds/$BUILD_ID")

            STATUS=$(echo "$RAW" | jq -r '.data.status' | tr '[:upper:]' '[:lower:]')

            echo "Current status: $STATUS"
          done

          APK_URL=$(echo "$RAW" | jq -r '.data.artifacts.buildUrl')

          echo "APK_URL=$APK_URL" >> $GITHUB_OUTPUT


      - name: Download APK
        run: |
          curl -L "${{ steps.wait-build.outputs.APK_URL }}" -o app-release.apk

      - name: Release APK
        uses: softprops/action-gh-release@v2
        with:
          tag_name: "v${{ github.run_number }}"
          name: "Release APK #${{ github.run_number }}"
          files: app-release.apk
          generate_release_notes: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

```

## License
All documentation in this repository is licensed under the [GNU GENERAL PUBLIC LICENSE](/LICENSE)
